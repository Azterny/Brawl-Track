<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #0f0f0f; color: #eee; font-family: 'Roboto', sans-serif; padding: 20px; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; text-align: center; display: inline-block; width: 150px; }
        .val { font-size: 1.5em; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; background: #1e1e1e; margin-top: 20px; }
        th, td { padding: 10px; border-bottom: 1px solid #333; text-align: left; }
        th { color: #ffce00; }
        button { cursor: pointer; padding: 5px 10px; border: none; border-radius: 4px; color: white; }
        .btn-del { background: #dc3545; }
        .btn-set { background: #007bff; margin-left: 5px; }
        select { padding: 5px; background: #333; color: white; border: 1px solid #555; }
    </style>
</head>
<body>
    <div id="login"><input type="password" id="pass" placeholder="Password"><button onclick="login()">Enter</button></div>
    <div id="dash" style="display:none;">
        <h1>Admin Panel</h1>
        <div>
            <div class="card">Users: <div id="c-users" class="val">--</div></div>
            <div class="card">Archives: <div id="c-arch" class="val">--</div></div>
            <div class="card">CPU: <div id="c-cpu" class="val">--%</div></div>
        </div>
        <table>
            <thead><tr><th>User</th><th>Tag</th><th>Tier</th><th>Freq (min)</th><th>Action</th></tr></thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
    <script>
        const API = "https://api.brawl-track.com/api/admin";
        let KEY = "";
        async function login() {
            KEY = document.getElementById('pass').value;
            try {
                const s = await fetch(`${API}/stats`, { headers: {'X-Admin-Pass': KEY} }).then(r=>r.json());
                if(!s.users) return alert("Wrong Password");
                document.getElementById('c-users').innerText = s.users;
                document.getElementById('c-arch').innerText = s.total_archives;
                document.getElementById('c-cpu').innerText = s.cpu_percent + "%";
                loadUsers();
                document.getElementById('login').style.display='none';
                document.getElementById('dash').style.display='block';
            } catch(e) { alert("Error"); }
        }
        async function loadUsers() {
            const users = await fetch(`${API}/users`, { headers: {'X-Admin-Pass': KEY} }).then(r=>r.json());
            const tb = document.getElementById('tbody'); tb.innerHTML = "";
            users.forEach(u => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${u.username}</td><td>${u.brawl_tag}</td>
                    <td>
                        <select id="tier-${u.id}">
                            <option value="basic" ${u.tier=='basic'?'selected':''}>Basic</option>
                            <option value="subscriber" ${u.tier=='subscriber'?'selected':''}>Abonn√©</option>
                            <option value="premium" ${u.tier=='premium'?'selected':''}>Premium</option>
                        </select>
                        <button class="btn-set" onclick="setTier(${u.id})">OK</button>
                    </td>
                    <td>${u.update_interval}</td>
                    <td><button class="btn-del" onclick="del(${u.id})">X</button></td>
                `;
                tb.appendChild(tr);
            });
        }
        async function setTier(id) {
            const t = document.getElementById(`tier-${id}`).value;
            await fetch(`${API}/set-tier`, { method:'POST', headers: {'X-Admin-Pass': KEY, 'Content-Type':'application/json'}, body: JSON.stringify({user_id: id, tier: t}) });
            alert("Updated"); loadUsers();
        }
        async function del(id) {
            if(confirm("Delete?")) { await fetch(`${API}/user/${id}`, { method:'DELETE', headers: {'X-Admin-Pass': KEY} }); loadUsers(); }
        }
    </script>
</body>
</html>
