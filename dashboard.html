<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Track - Tableau de Bord</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="container wide">
        
        <div class="header-bar">
            <div style="text-align: left;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <h1 id="player-name" style="margin: 0;">Chargement...</h1>
                    <span id="tier-badge" class="badge badge-basic">Basic</span>
                </div>
                <div id="player-tag" style="color: #888; font-size: 0.9em; margin-top: 5px;">#...</div>
            </div>

            <div id="burger-menu" class="hidden" style="position: relative;">
                <div class="burger-icon" onclick="toggleMenu()">â˜°</div>
                <div class="menu-overlay" id="menu-dropdown">
                    <div class="menu-item" onclick="switchView('dashboard')">ğŸ  Accueil</div>
                    <div class="menu-item" onclick="switchView('data')">ğŸ’¾ DonnÃ©es & Auto</div>
                    <div class="menu-item" onclick="switchView('settings')">âš™ï¸ ParamÃ¨tres</div>
                    <div class="menu-item-divider"></div>
                    <div class="menu-item" onclick="loadMyStats()">ğŸ”„ Actualiser</div>
                    <div class="menu-item logout" onclick="logout()">ğŸšª DÃ©connexion</div>
                </div>
            </div>

            <div id="public-actions" class="hidden">
                <button onclick="window.location.href='index.html'" style="width: auto; background: #444; color:white; padding: 5px 15px;">â¬… Retour</button>
            </div>
        </div>

        <div id="view-dashboard" class="view-section active">
            <p id="dashboard-msg" style="color: #aaa; font-style: italic;"></p>
            
            <div id="stats-area" class="stats-grid"></div>

            <div id="chart-container" class="hidden" style="margin-top: 30px; background: #222; padding: 15px; border-radius: 10px;">
                <h3 style="margin:0 0 15px 0; color: #ffce00;">ğŸ“ˆ Progression</h3>
                <canvas id="trophyChart"></canvas>
            </div>

            <div style="margin-top: 40px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #444; padding-top: 20px;">
                <h3 style="margin: 0;">ğŸ¤– Brawlers</h3>
                <select id="sort-brawlers" onchange="sortBrawlers()" style="width: auto; padding: 5px; background: #333; color: white; border: 1px solid #555;">
                    <option value="trophies">â–¼ TrophÃ©es</option>
                    <option value="name">A-Z Nom</option>
                    <option value="id">Base (ID)</option>
                </select>
            </div>
            <div id="brawlers-grid" style="margin-top: 15px;"></div>
        </div>

        <div id="view-data" class="view-section">
            <h2>ğŸ’¾ Gestion des DonnÃ©es</h2>
            
            <div style="background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left; border-left: 4px solid #007bff;">
                <h3 style="margin-top: 0;">â±ï¸ Actualisation Automatique</h3>
                <p style="color: #ccc; font-size: 0.9em; margin-bottom: 15px;">
                    Nos robots mettent Ã  jour votre compte pÃ©riodiquement, mÃªme si vous ne vous connectez pas.
                </p>
                
                <label style="font-weight: bold;">FrÃ©quence de mise Ã  jour :</label>
                
                <div id="interval-basic" class="hidden" style="margin-top: 10px;">
                    <select id="select-interval-basic">
                        <option value="2880">Toutes les 48 Heures</option>
                        <option value="2160">Toutes les 36 Heures</option>
                        <option value="1440">Toutes les 24 Heures</option>
                        <option value="720">Toutes les 12 Heures</option>
                    </select>
                </div>

                <div id="interval-custom" class="hidden" style="margin-top: 10px;">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1;">
                            <span style="font-size:0.8em; color:#aaa;">Heures</span>
                            <input type="number" id="input-hours" placeholder="0" min="0" max="48">
                        </div>
                        <div style="flex:1;">
                            <span style="font-size:0.8em; color:#aaa;">Minutes</span>
                            <input type="number" id="input-minutes" placeholder="0" min="0" max="59">
                        </div>
                    </div>
                    <p style="font-size: 0.8em; color: #ffce00; margin-top: 5px;" id="interval-limit-msg"></p>
                </div>

                <button class="btn-save" onclick="saveInterval()" style="margin-top: 15px;">ğŸ’¾ Enregistrer la frÃ©quence</button>
            </div>

            <div style="background: #2a2a2a; padding: 20px; border-radius: 10px; text-align: left;">
                <h3 style="margin-top: 0;">ğŸ› ï¸ Actions Manuelles</h3>
                <button onclick="manualArchive()" style="background: #17a2b8; margin-bottom: 25px;">â• Forcer une sauvegarde maintenant</button>
                
                <h4 style="margin-bottom: 5px; border-top: 1px solid #444; padding-top: 15px;">Nettoyage historique</h4>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="delete-select" style="flex: 2; margin: 0;">
                        <option value="7">Plus vieux que 7 Jours</option>
                        <option value="31">Plus vieux que 1 Mois</option>
                        <option value="all">âš ï¸ TOUT Supprimer</option>
                    </select>
                    <button onclick="deleteArchives()" class="btn-danger" style="flex: 1; margin: 0;">Supprimer</button>
                </div>
            </div>
        </div>

        <div id="view-settings" class="view-section">
            <h2>âš™ï¸ ParamÃ¨tres du Compte</h2>
            
            <div style="background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                <h3 style="margin-top: 0;">Modifier Profil</h3>
                <label>Nouveau nom d'utilisateur</label>
                <input type="text" id="new-username" placeholder="Pseudo">
                
                <label>Nouveau mot de passe</label>
                <input type="password" id="new-password" placeholder="Mot de passe">
                
                <button class="btn-save" onclick="updateProfile()">Sauvegarder les changements</button>
            </div>

            <div style="background: #331515; padding: 20px; border-radius: 10px; text-align: left; border: 1px solid #dc3545;">
                <h3 style="color: #ff5555; margin-top: 0;">Zone de Danger</h3>
                <p style="font-size: 0.9em; color: #ddd;">La suppression du compte est dÃ©finitive et effacera tout votre historique de trophÃ©es.</p>
                <button class="btn-danger" onclick="deleteAccount()">ğŸ—‘ï¸ SUPPRIMER MON COMPTE</button>
            </div>
        </div>

    </div>

    <script src="script.js"></script>
    <script>
        // Initialisation
        const urlParams = new URLSearchParams(window.location.search);
        const publicTag = urlParams.get('tag');

        if (publicTag) {
            loadPublicProfile(publicTag);
        } else {
            checkAuth();
        }
    </script>
</body>
</html>
